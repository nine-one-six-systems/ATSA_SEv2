---
phase: 03-split-screen-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/joint_analysis.html
  - static/css/style.css
  - app.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Tax professional can navigate to /joint-analysis.html and see a page with split-screen layout structure"
    - "Page displays two side-by-side panels with placeholder content and a comparison section below"
    - "Layout stacks vertically on screens narrower than 768px"
    - "Navbar includes Joint Analysis link with proper active state"
  artifacts:
    - path: "templates/joint_analysis.html"
      provides: "Split-screen template with Jinja2 structure"
      contains: "split-screen-container"
    - path: "static/css/style.css"
      provides: "Split-screen grid layout, responsive stacking"
      contains: ".joint-analysis-page"
    - path: "app.py"
      provides: "Route registration for joint analysis page"
      contains: "/joint-analysis.html"
  key_links:
    - from: "app.py"
      to: "templates/joint_analysis.html"
      via: "render_template"
      pattern: "render_template.*joint_analysis"
    - from: "templates/joint_analysis.html"
      to: "static/css/style.css"
      via: "url_for static"
      pattern: "url_for.*static.*style.css"
---

<objective>
Create the joint analysis page foundation: HTML template with split-screen structure, CSS styles for the layout, and Flask route registration.

Purpose: Establish the visual foundation for the centerpiece dual-filer view that tax professionals use with clients. Template defines DOM structure that JavaScript will populate.

Output: Navigable /joint-analysis.html page with two-panel layout and comparison section, responsive stacking at 768px breakpoint.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-split-screen-ui/03-RESEARCH.md

# Key existing files to follow patterns from
@templates/analysis.html
@static/css/style.css
@app.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create joint_analysis.html template</name>
  <files>templates/joint_analysis.html</files>
  <action>
Create new template following existing analysis.html pattern:

1. Standard HTML5 doctype with charset and viewport meta tags
2. Title: "Joint Analysis - ATSA"
3. Link to style.css using url_for pattern: `{{ url_for('static', filename='css/style.css') }}`
4. Include Split.js CDN in head: `<script src="https://unpkg.com/split.js@1.6.5/dist/split.min.js"></script>`
5. Navbar with "Joint Analysis" link marked as active (class="active")
6. Add "Joint Analysis" to nav menu in ALL existing templates for consistency (analysis.html, clients.html, calculator.html, upload.html, index.html)

Main content structure:
```html
<main class="container">
    <div class="joint-analysis-page">
        <div class="page-header">
            <h2>Joint Tax Analysis</h2>
            <div class="spouse-selector">
                <!-- Client dropdowns populated by JS -->
                <select id="spouse1-select"><option value="">Select Spouse 1...</option></select>
                <select id="spouse2-select"><option value="">Select Spouse 2...</option></select>
                <button class="btn btn-primary" id="load-analysis-btn">Load Analysis</button>
            </div>
        </div>

        <!-- Split-screen container for spouse panels -->
        <div class="split-screen-container" id="split-container">
            <div id="spouse1-panel" class="spouse-panel">
                <h3 id="spouse1-name">Spouse 1</h3>
                <div id="spouse1-content" class="panel-content">
                    <p class="loading">Select clients to view joint analysis</p>
                </div>
            </div>

            <div id="spouse2-panel" class="spouse-panel">
                <h3 id="spouse2-name">Spouse 2</h3>
                <div id="spouse2-content" class="panel-content">
                    <p class="loading">Select clients to view joint analysis</p>
                </div>
            </div>
        </div>

        <!-- Comparison section below split panes -->
        <div class="comparison-section" id="comparison-section">
            <h3>MFJ vs MFS Comparison</h3>
            <div id="comparison-content">
                <p class="loading">Analysis comparison will appear here</p>
            </div>
        </div>
    </div>
</main>
```

7. Link to joint_analysis.js at bottom (before closing body): `{{ url_for('static', filename='js/joint_analysis.js') }}`

Important: Template defines DOM IDs that JavaScript will reference:
- spouse1-select, spouse2-select (dropdowns)
- load-analysis-btn (trigger button)
- spouse1-panel, spouse2-panel (Split.js targets)
- spouse1-name, spouse2-name (name display)
- spouse1-content, spouse2-content (panel content areas)
- comparison-content (comparison section)
  </action>
  <verify>
- File exists at templates/joint_analysis.html
- Contains DOCTYPE, head with Split.js CDN, navbar, main content structure
- All required IDs present: spouse1-panel, spouse2-panel, comparison-content, etc.
  </verify>
  <done>
Template file created with complete split-screen HTML structure including:
- Split.js CDN script tag in head
- Navbar with Joint Analysis link (active)
- Two-panel split-screen container with IDs for Split.js
- Comparison section below
- Link to joint_analysis.js
  </done>
</task>

<task type="auto">
  <name>Task 2: Add split-screen CSS styles to style.css</name>
  <files>static/css/style.css</files>
  <action>
Append new CSS rules to the end of style.css (do not modify existing styles).

Add these styles following existing patterns (color palette: #3498db primary, #e74c3c danger, #27ae60 success):

```css
/* ===========================================
   JOINT ANALYSIS - SPLIT SCREEN LAYOUT
   =========================================== */

.joint-analysis-page {
    display: grid;
    grid-template-rows: auto 1fr auto;
    height: calc(100vh - 120px);
    gap: 1rem;
}

.joint-analysis-page .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.spouse-selector {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
}

.spouse-selector select {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.9rem;
    min-width: 180px;
}

/* Split-screen container */
.split-screen-container {
    display: flex;
    height: 100%;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.spouse-panel {
    overflow-y: auto;
    padding: 1.5rem;
    background: white;
    min-width: 0;
}

.spouse-panel h3 {
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #3498db;
    color: #2c3e50;
}

.panel-content {
    min-height: 200px;
}

/* Split.js gutter styling */
.gutter {
    background-color: #e0e0e0;
    background-repeat: no-repeat;
    background-position: 50%;
    cursor: col-resize;
    flex-shrink: 0;
}

.gutter:hover {
    background-color: #3498db;
}

.gutter.gutter-horizontal {
    width: 10px;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
}

/* Income breakdown per spouse (REQ-19) */
.income-breakdown {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 4px;
    margin-bottom: 1.5rem;
    border-left: 3px solid #3498db;
}

.income-breakdown h4 {
    margin-bottom: 0.75rem;
    color: #2c3e50;
    font-size: 0.95rem;
}

.income-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
    font-size: 0.9rem;
}

.income-item:last-of-type {
    border-bottom: none;
}

.income-total {
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 2px solid #3498db;
    display: flex;
    justify-content: space-between;
    font-weight: 600;
}

/* Spouse summary grid */
.spouse-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

/* Comparison section (REQ-18) */
.comparison-section {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow-y: auto;
    max-height: 450px;
}

.comparison-section h3 {
    margin-bottom: 1rem;
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 0.5rem;
}

.comparison-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.recommendation-badge {
    margin-top: 0.5rem;
    padding: 0.25rem 0.75rem;
    background: #27ae60;
    color: white;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
    text-align: center;
    display: inline-block;
}

.savings-note {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #555;
    font-style: italic;
}

/* Comparison table (REQ-20) */
.comparison-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
    margin-top: 1rem;
}

.comparison-table thead {
    background: #3498db;
    color: white;
}

.comparison-table th {
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
}

.comparison-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #eee;
}

.comparison-table tbody tr:hover {
    background: #f5f5f5;
}

.comparison-table tr.highlight {
    background: #f0f7ff;
    font-weight: 600;
}

.comparison-table tr.highlight td {
    border-bottom: 2px solid #3498db;
}

/* Responsive: stack at 768px */
@media (max-width: 768px) {
    .joint-analysis-page {
        grid-template-rows: auto;
        height: auto;
    }

    .joint-analysis-page .page-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .spouse-selector {
        width: 100%;
    }

    .spouse-selector select {
        flex: 1;
        min-width: 0;
    }

    .split-screen-container {
        flex-direction: column;
        height: auto;
    }

    .spouse-panel {
        min-height: auto;
        margin-bottom: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .gutter {
        display: none;
    }

    .comparison-section {
        max-height: none;
    }

    .comparison-table {
        display: block;
        overflow-x: auto;
    }
}
```
  </action>
  <verify>
- style.css contains new .joint-analysis-page rules
- .split-screen-container uses flexbox (for Split.js compatibility)
- .gutter styles present for Split.js divider
- @media (max-width: 768px) rules present for responsive stacking
- .comparison-table, .income-breakdown, .comparison-cards styles exist
  </verify>
  <done>
CSS styles appended to style.css including:
- Grid layout for joint-analysis-page
- Flexbox split-screen-container for Split.js
- Gutter styling with hover effect
- Income breakdown styles (REQ-19)
- Comparison cards and table styles (REQ-18, REQ-20)
- Mobile responsive rules at 768px breakpoint
  </done>
</task>

<task type="auto">
  <name>Task 3: Register route in app.py and update navbar in all templates</name>
  <files>app.py, templates/analysis.html, templates/clients.html, templates/calculator.html, templates/upload.html, templates/index.html</files>
  <action>
1. Add route to app.py following existing pattern (after calculator route, before init_database):

```python
@app.route('/joint-analysis.html')
def joint_analysis():
    return render_template('joint_analysis.html')
```

2. Update navbar in ALL templates to include Joint Analysis link:

In each template's nav-menu ul, add the Joint Analysis link after Analysis:
```html
<li><a href="/joint-analysis.html">Joint Analysis</a></li>
```

For joint_analysis.html template (created in Task 1), this link should have class="active".

Templates to update:
- templates/index.html
- templates/clients.html
- templates/upload.html
- templates/analysis.html
- templates/calculator.html

Ensure consistent nav order across all templates:
1. Dashboard (/)
2. Clients (/clients.html)
3. Upload Documents (/upload.html)
4. Analysis (/analysis.html)
5. Joint Analysis (/joint-analysis.html)
6. Calculator (/calculator.html)
  </action>
  <verify>
- `curl -s http://localhost:5555/joint-analysis.html | head -20` returns HTML with "Joint Analysis - ATSA" title
- Route registered in app.py
- All templates have Joint Analysis in navbar
  </verify>
  <done>
Route registered and navbar updated:
- app.py has /joint-analysis.html route returning joint_analysis.html template
- All 6 templates (index, clients, upload, analysis, joint_analysis, calculator) have consistent navbar with Joint Analysis link
  </done>
</task>

</tasks>

<verification>
1. Start Flask app: `python app.py`
2. Navigate to http://localhost:5555/joint-analysis.html
3. Verify page loads with:
   - Title "Joint Analysis - ATSA"
   - Navbar with "Joint Analysis" link active
   - Two-panel layout visible (even without data)
   - Comparison section at bottom
4. Resize browser to <768px width - panels should stack vertically
5. Check other pages (clients.html, analysis.html) - Joint Analysis should appear in navbar
</verification>

<success_criteria>
1. /joint-analysis.html route returns 200 OK
2. Template renders with correct DOM structure (split-screen-container, spouse panels, comparison-section)
3. CSS styles applied correctly (two-column layout on desktop, single column on mobile)
4. Split.js CDN script tag present in head
5. Navbar consistent across all pages with Joint Analysis link
6. Page structure ready for JavaScript population in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/03-split-screen-ui/03-01-SUMMARY.md`
</output>
